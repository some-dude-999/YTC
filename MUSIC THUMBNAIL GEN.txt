=== MUSIC THUMBNAIL GEN.txt ===
PROJECT: YTC - YouTube Content Tools
COMPONENT: YouTube Thumbnail Creator with Text
CREATED: 2025-11-19
LAST UPDATED: 2025-11-23 - Fixed image upload with enhanced error handling and event handling

DATA SOURCES:
- User Input: Text overlay, subtitle selection, font category, text effects, text color, text transformation
- File: User-uploaded image (background for thumbnail)
- External: Google Fonts API (560+ fonts loaded dynamically)
- LocalStorage: Subtitle selection persistence

FUNCTIONALITY:
- Main Purpose: Create 1280x720 YouTube thumbnails with custom text in various fonts
- Key Functions:
  * loadGoogleFonts() - Dynamically loads all fonts from Google Fonts API
  * generatePreviews() - Creates preview cards for all fonts (or filtered category)
  * drawCanvas(canvas, preview) - Renders image + text overlay at specified resolution
  * createPreviewCard(preview, identifier) - Builds interactive preview with controls
  * updateLinkedFont(fontName) - Syncs customizations between favorites and main grid
  * updateNonCustomizedPreviews() - Applies master template changes to all non-customized fonts
- Event Handlers:
  * Text input updates all previews in real-time
  * Drag-and-drop for image upload
  * Canvas click for keyboard control focus
  * Arrow keys for 1px text positioning
  * Mouse drag for text repositioning with snap-to-center

DEPENDENCIES:
- External Libraries: Google Fonts API (all fonts loaded via CDN)
- Project Files: None (standalone HTML file)
- APIs Required: https://fonts.googleapis.com/css2

INTEGRATION:
- Receives data from: User image file, user text input, Google Fonts CDN
- Sends data to: Browser download (PNG exports at 1280x720)
- Triggers: Image upload, text input changes, font customization

TECHNICAL DETAILS:
- Resolution: Full-res 1280x720 (displays at 640x360 preview)
- Font Categories: 21 categories (bold, futuristic, modern, clean, condensed, display, elegant, script, retro, hip-hop, minimal, corporate, grunge, rounded, techno, halloween, christmas, synthwave, space, medieval, pirate)
- Category Selection: Multi-select checkbox system with "Select All" button
- Font Display: Each font shows its category memberships (e.g., "Bebas Neue - Bold, Hip-Hop, Retro")
- Total Fonts: 560+ from Google Fonts
- Export Format: PNG (image/png)
- Text Effects: Drop shadow, glow, or none
- Text Colors: White or black
- Text Transformations: None, uppercase, lowercase, title case

SUBTITLE FEATURE (Added 2025-11-22, Updated 2025-11-23):
- Position: Always appears below main title text with adjustable spacing
- Font: Fixed Arial font family
- Case: Always uppercase (automatically converted)
- Font Size: Proportional to main title (37.5% ratio - scales with main title changes)
  * Default: 30px when main title is 80px
  * Example: If main title = 52px (65% of 80), subtitle = 19.5px (65% of 30)
- Width Matching: Dynamically adjusts letter-spacing to be 98% of main title width (almost same but not quite)
- Dividing Line: Optional horizontal line (2px thick) between title and subtitle, matching title width
  * Toggle: Checkbox to show/hide dividing line (default: ON)
  * Persistence: Toggle state saved to localStorage and restored on page load
- Spacing Control (Added 2025-11-23):
  * Slider: -20px to +20px range for precise control
  * Presets: Less (-6px), Normal (0px - default), More (6px)
  * Real-time label updates showing current spacing value
  * Negative values move subtitle closer to dividing line, positive values push it further away
- Subtitle Options (via radio buttons):
  * Sleep Music
  * Sleep Sounds
  * Sleep Music + Sounds
  * Relaxing Music
  * Christmas Music
  * Halloween Music
  * Synthwave
- Persistence: Selection saved to localStorage and restored on page load
- Effects: Inherits same text effects (shadow/glow/none) and color as main text
- Dynamic Letter-Spacing Algorithm:
  1. Measures main title width (including any letter spacing)
  2. Calculates target subtitle width as 98% of main title width
  3. Measures subtitle base width (all characters without spacing)
  4. Calculates required letter-spacing: (targetWidth - subtitleWidth) / (numChars - 1)
  5. Renders each character individually with calculated spacing to match target width
  6. If subtitle is naturally wider than target, centers it without adjustment

BRAIN ICONS FEATURE (Added 2025-11-22):
- Toggle: Checkbox to show/hide brain icons (default: ON)
- Left Icon: ðŸš€ Rocket (representing left brain - logic/analytical)
- Right Icon: ðŸŒˆ Rainbow (representing right brain - creative/artistic)
- Positioning: Icons placed on left and right sides of the entire text box (main title + line + subtitle)
- Size: Icons scale at 80% of main title font size
- Padding: 20px space between icons and text box edges
- Color: Inherits same color as text (white or black)
- Effects: Inherits same text effects (shadow/glow/none) as main text
- Persistence: Toggle state saved to localStorage and restored on page load
- Vertical Alignment: Icons centered vertically with the main title text

MASTER TEMPLATE SYSTEM:
- Arial Master Template: First preview card acts as master template
- Default Settings: fontSize 80px, letterSpacing 0, textX 0.5, textY 0.5
- Customization Tracking: fontCustomizations object stores per-font overrides
- Linking Logic: Fonts without customizations follow master template changes
- "Relink All" Button: Clears all customizations and resets to master

FAVORITES SYSTEM:
- Star Button: Click to favorite/unfavorite any font
- Favorites Grid: Displays above main grid when favorites exist
- Persistence: None (localStorage not implemented - resets on page reload)
- Gold Styling: Favorites have gold border and special highlighting

POSITIONING CONTROLS:
- Mouse Drag: Click and drag text, 5% snap threshold for center alignment
- Keyboard Control: Click canvas to focus, then use arrow keys for 1px precision
- Visual Feedback: Green border indicates focused canvas
- Master Template: Moving master updates all non-customized fonts on mouse release

SLIDER CONTROLS (per preview):
- Size: 20-200px (default 80px)
- Character Spacing: -10 to 50px (default 0px)
- Master Behavior: Changes apply to all non-customized fonts when slider released
- Individual Behavior: Changes saved to fontCustomizations, synced between favorite/main grid

WORKFLOW:
1. User uploads background image (drag-drop or click)
2. User enters main title text
3. User selects subtitle option (choice persists via localStorage)
4. Arial master template appears first
5. All fonts render below (or filtered by category)
6. User adjusts master template (text position, size, spacing)
7. All non-customized fonts inherit master settings
8. User can customize individual fonts (breaks link to master)
9. User favorites preferred fonts (appear at top)
10. Subtitle automatically adjusts letter-spacing to match main title width
11. User downloads selected thumbnails as 1280x720 PNG files
12. "Relink All" resets all customizations to master template

BROWSER COMPATIBILITY:
- Modern browsers with Canvas API support
- Requires internet connection for Google Fonts CDN
- FileReader API for image upload

CORRECTIONS & CLARIFICATIONS:
- Initially thought: Fonts were embedded in the HTML file
- Actually: Fonts are loaded dynamically from Google Fonts CDN via single API call
- Why this matters: Requires internet connection; cannot work offline

- Initially thought: Favorites were persistent across sessions
- Actually: Favorites reset on page reload (no localStorage implementation)
- Why this matters: Users must complete workflow in single session

- Initially thought: Master template forces all fonts to match
- Actually: Master template only affects non-customized fonts; customizations persist until "Relink All"
- Why this matters: Users can mix master-linked and custom fonts

RECENT FIXES (2025-11-23):
- CRITICAL: Fixed duplicate spacingGroup variable declaration (SyntaxError on line 1714)
  * Renamed second spacingGroup to subtitleSpacingGroup
  * This error prevented the entire script from executing
  * Image upload wasn't working because event listeners were never attached
- Fixed image upload click handler with event.stopPropagation() to prevent event bubbling
- Added comprehensive console logging for debugging upload issues
- Added defensive checks to ensure DOM elements exist before attaching event listeners
- Added error handlers for FileReader and Image loading failures
- Why this matters: The duplicate variable was a critical bug that broke all functionality; proper event handling improves reliability across browsers

SUBTITLE SPACING UPDATE (2025-11-23):
- Changed spacing preset values: Less=-6px, Normal=0px (default), More=6px
- Added slider control for subtitle spacing: -20px to +20px range
- Slider provides fine-grained control with real-time label updates
- Preset buttons highlight in blue when slider matches their values
- Default spacing is now 0px (Normal) instead of 4px
- Why this matters: Negative spacing moves subtitle closer to dividing line, positive spacing moves it further away, giving more design flexibility

NOTES:
- Font categories designed for music genres (EDM, hip-hop, lo-fi, etc.)
- Some fonts appear in multiple categories (e.g., "Creepster" in halloween, grunge, pirate)
- Arrow key positioning shows green border to indicate focused canvas
- Preview renders at 640x360, downloads at full 1280x720
- Letter spacing implemented with manual character positioning (not CSS letter-spacing)
- Text effects scale with resolution (shadow blur, offset calculated based on canvas size)
- Consider adding: localStorage persistence, batch download, custom font upload
===
